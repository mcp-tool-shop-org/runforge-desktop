<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RunForgeDesktop.ViewModels"
             x:Class="RunForgeDesktop.Views.NewRunPage"
             x:DataType="vm:NewRunViewModel"
             Title="New Run"
             BackgroundColor="{AppThemeBinding Light=#F5F7FA, Dark=#121317}">

    <ScrollView Padding="32,24">
        <VerticalStackLayout Spacing="24" MaximumWidthRequest="540">

            <!-- Header -->
            <VerticalStackLayout Spacing="4">
                <Label Text="New Training Run"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#1A1A2E, Dark=#FFFFFF}" />
                <Label Text="Configure and start a new training job"
                       FontSize="14"
                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}" />
            </VerticalStackLayout>

            <!-- Form Card -->
            <Border BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E2028}"
                    Stroke="{AppThemeBinding Light=#E2E8F0, Dark=#2D3748}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 12"
                    Padding="28">

                <VerticalStackLayout Spacing="28">

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Identity
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="IDENTITY"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Run Name -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Run Name"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                            <Entry Text="{Binding RunName}"
                                   Placeholder="e.g., sloaq_experiment_01"
                                   FontSize="14"
                                   BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#0F172A}"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#F3F4F6}"
                                   PlaceholderColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#2D3748}"
                             Margin="0,4" />

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Model
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="MODEL"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Preset -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Preset"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                            <Picker ItemsSource="{Binding AvailablePresets}"
                                    SelectedItem="{Binding SelectedPreset}"
                                    FontSize="14"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#0F172A}"
                                    TextColor="{AppThemeBinding Light=#1F2937, Dark=#F3F4F6}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#2D3748}"
                             Margin="0,4" />

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Data
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="DATA"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Dataset Path -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Dataset"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                <Entry Grid.Column="0"
                                       Text="{Binding DatasetPath}"
                                       Placeholder="Path to dataset..."
                                       FontSize="14"
                                       BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#0F172A}"
                                       TextColor="{AppThemeBinding Light=#1F2937, Dark=#F3F4F6}"
                                       PlaceholderColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}" />
                                <Button Grid.Column="1"
                                        Text="Browse"
                                        Command="{Binding BrowseDatasetCommand}"
                                        BackgroundColor="Transparent"
                                        BorderColor="{AppThemeBinding Light=#D1D5DB, Dark=#4B5563}"
                                        BorderWidth="1"
                                        TextColor="{AppThemeBinding Light=#374151, Dark=#D1D5DB}"
                                        CornerRadius="6"
                                        Padding="16,8"
                                        FontSize="13" />
                            </Grid>
                            <!-- Dataset helper text -->
                            <Label Text="{Binding DatasetHelperText}"
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                   IsVisible="{Binding DatasetHelperText, Converter={StaticResource StringToBoolConverter}}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#2D3748}"
                             Margin="0,4" />

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Execution
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="EXECUTION"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Device Selection -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Device"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                            <HorizontalStackLayout Spacing="24">
                                <HorizontalStackLayout Spacing="8">
                                    <RadioButton IsChecked="{Binding UseGpu}"
                                                 IsEnabled="{Binding GpuAvailable}"
                                                 GroupName="Device" />
                                    <Label Text="GPU"
                                           FontSize="14"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="8">
                                    <RadioButton IsChecked="{Binding UseGpu, Converter={StaticResource InverseBoolConverter}}"
                                                 GroupName="Device" />
                                    <Label Text="CPU"
                                           FontSize="14"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                                </HorizontalStackLayout>
                            </HorizontalStackLayout>
                            <!-- Device helper text -->
                            <Label Text="{Binding DeviceHelperText}"
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- ═══════════════════════════════════════════════════════════
                         ERROR + ACTION
                         ═══════════════════════════════════════════════════════════ -->

                    <!-- Error Message -->
                    <Border IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}"
                            BackgroundColor="#FEE2E2"
                            Stroke="#FECACA"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 8"
                            Padding="12,10">
                        <Label Text="{Binding ErrorMessage}"
                               TextColor="#DC2626"
                               FontSize="13" />
                    </Border>

                    <!-- Start Button -->
                    <Button Text="{Binding IsCreating, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Starting...|Start Training'}"
                            Command="{Binding StartTrainingCommand}"
                            IsEnabled="{Binding IsCreating, Converter={StaticResource InverseBoolConverter}}"
                            BackgroundColor="{AppThemeBinding Light=#4F46E5, Dark=#6366F1}"
                            TextColor="White"
                            CornerRadius="8"
                            Padding="24,16"
                            FontSize="16"
                            FontAttributes="Bold"
                            HorizontalOptions="Fill" />

                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
