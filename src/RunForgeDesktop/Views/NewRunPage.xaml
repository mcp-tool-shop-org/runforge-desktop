<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RunForgeDesktop.ViewModels"
             x:Class="RunForgeDesktop.Views.NewRunPage"
             x:DataType="vm:NewRunViewModel"
             Title="New Run"
             BackgroundColor="{AppThemeBinding Light=#F5F7FA, Dark=#121317}">

    <ScrollView Padding="32,24">
        <VerticalStackLayout Spacing="24" MaximumWidthRequest="540">

            <!-- Header -->
            <VerticalStackLayout Spacing="4">
                <Label Text="New Training Run"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#1A1A2E, Dark=#FFFFFF}"
                       SemanticProperties.HeadingLevel="Level1" />
                <Label Text="Configure and start a new run"
                       FontSize="14"
                       TextColor="{AppThemeBinding Light=#64748B, Dark=#94A3B8}"
                       SemanticProperties.Description="Form to configure a new training run" />
            </VerticalStackLayout>

            <!-- No Workspace Banner - blocks form until workspace selected -->
            <Border IsVisible="{Binding HasWorkspace, Converter={StaticResource InverseBoolConverter}}"
                    BackgroundColor="{AppThemeBinding Light=#FEF3C7, Dark=#1C1917}"
                    Stroke="{AppThemeBinding Light=#FCD34D, Dark=#44403C}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 12"
                    Padding="20"
                    SemanticProperties.Description="Warning: Workspace required. Go to Dashboard and select a workspace to store your runs.">
                <HorizontalStackLayout Spacing="12">
                    <Label Text="⚠"
                           FontSize="24"
                           VerticalOptions="Start"
                           TextColor="{AppThemeBinding Light=#92400E, Dark=#FCD34D}"
                           SemanticProperties.Description="Warning icon" />
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Workspace Required"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#92400E, Dark=#FCD34D}" />
                        <Label Text="Go to Dashboard → Select Workspace to store your runs."
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#B45309, Dark=#F59E0B}" />
                    </VerticalStackLayout>
                </HorizontalStackLayout>
            </Border>

            <!-- Workspace Info - shown when workspace is set -->
            <Border IsVisible="{Binding HasWorkspace}"
                    BackgroundColor="{AppThemeBinding Light=#F0FDF4, Dark=#14532D}"
                    Stroke="{AppThemeBinding Light=#86EFAC, Dark=#166534}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 8"
                    Padding="16,12"
                    SemanticProperties.Description="{Binding WorkspaceDisplayName, StringFormat='Current workspace: {0}'}">
                <HorizontalStackLayout Spacing="8">
                    <Label Text="✓"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#166534, Dark=#86EFAC}"
                           SemanticProperties.Description="Checkmark icon" />
                    <Label Text="Workspace:"
                           FontSize="13"
                           TextColor="{AppThemeBinding Light=#166534, Dark=#86EFAC}" />
                    <Label Text="{Binding WorkspaceDisplayName}"
                           FontSize="13"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#15803D, Dark=#4ADE80}" />
                </HorizontalStackLayout>
            </Border>

            <!-- Form Card - only interactive when workspace exists -->
            <Border BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E2028}"
                    Stroke="{AppThemeBinding Light=#E2E8F0, Dark=#2D3748}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 12"
                    Padding="28">

                <VerticalStackLayout Spacing="28">

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Identity
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="IDENTITY"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Run Name -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Run Name"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}"
                                   x:Name="RunNameLabel" />
                            <Entry Text="{Binding RunName}"
                                   Placeholder="e.g., sloaq_experiment_01"
                                   FontSize="14"
                                   BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#0F172A}"
                                   TextColor="{AppThemeBinding Light=#1F2937, Dark=#F3F4F6}"
                                   PlaceholderColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                   SemanticProperties.Description="Run name input field. Example: sloaq_experiment_01" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#2D3748}"
                             Margin="0,4" />

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Model
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="MODEL"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Preset -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Preset"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                            <Picker ItemsSource="{Binding AvailablePresets}"
                                    SelectedItem="{Binding SelectedPreset}"
                                    FontSize="14"
                                    BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#0F172A}"
                                    TextColor="{AppThemeBinding Light=#1F2937, Dark=#F3F4F6}"
                                    SemanticProperties.Description="Model preset selector. Choose a training configuration." />
                            <Label Text="Defines model architecture and training settings."
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#2D3748}"
                             Margin="0,4" />

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Data
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="DATA"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Dataset Path -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Dataset (optional)"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                <Entry Grid.Column="0"
                                       Text="{Binding DatasetPath}"
                                       Placeholder="Path to dataset..."
                                       FontSize="14"
                                       BackgroundColor="{AppThemeBinding Light=#F9FAFB, Dark=#0F172A}"
                                       TextColor="{AppThemeBinding Light=#1F2937, Dark=#F3F4F6}"
                                       PlaceholderColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                       SemanticProperties.Description="Dataset path input. Enter path to training data folder or file." />
                                <Button Grid.Column="1"
                                        Text="Browse"
                                        Command="{Binding BrowseDatasetCommand}"
                                        BackgroundColor="Transparent"
                                        BorderColor="{AppThemeBinding Light=#D1D5DB, Dark=#4B5563}"
                                        BorderWidth="1"
                                        TextColor="{AppThemeBinding Light=#374151, Dark=#D1D5DB}"
                                        CornerRadius="6"
                                        Padding="16,8"
                                        FontSize="13"
                                        SemanticProperties.Description="Browse for dataset folder" />
                            </Grid>
                            <!-- Dataset helper text - always visible -->
                            <Label Text="{Binding DatasetHelperText}"
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                   SemanticProperties.Description="{Binding DatasetHelperText}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- Divider -->
                    <BoxView HeightRequest="1"
                             Color="{AppThemeBinding Light=#E5E7EB, Dark=#2D3748}"
                             Margin="0,4" />

                    <!-- ═══════════════════════════════════════════════════════════
                         SECTION: Execution
                         ═══════════════════════════════════════════════════════════ -->
                    <VerticalStackLayout Spacing="12">
                        <Label Text="EXECUTION"
                               FontSize="11"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                               CharacterSpacing="1" />

                        <!-- Device Selection -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Device"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                            <HorizontalStackLayout Spacing="24"
                                                   SemanticProperties.Description="Device selection. Choose GPU for faster training or CPU for compatibility.">
                                <HorizontalStackLayout Spacing="8">
                                    <RadioButton IsChecked="{Binding UseGpu}"
                                                 IsEnabled="{Binding GpuAvailable}"
                                                 GroupName="Device"
                                                 SemanticProperties.Description="GPU device option. Faster training with CUDA support." />
                                    <Label Text="GPU"
                                           FontSize="14"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="8">
                                    <RadioButton IsChecked="{Binding UseGpu, Converter={StaticResource InverseBoolConverter}}"
                                                 GroupName="Device"
                                                 SemanticProperties.Description="CPU device option. Compatible with all systems." />
                                    <Label Text="CPU"
                                           FontSize="14"
                                           VerticalOptions="Center"
                                           TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}" />
                                </HorizontalStackLayout>
                            </HorizontalStackLayout>
                            <!-- Device helper text -->
                            <Label Text="{Binding DeviceHelperText}"
                                   FontSize="12"
                                   TextColor="{AppThemeBinding Light=#9CA3AF, Dark=#6B7280}"
                                   SemanticProperties.Description="{Binding DeviceHelperText}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>

                    <!-- ═══════════════════════════════════════════════════════════
                         ERROR + ACTION
                         ═══════════════════════════════════════════════════════════ -->

                    <!-- Error Message -->
                    <Border IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBoolConverter}}"
                            BackgroundColor="#FEE2E2"
                            Stroke="#FECACA"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 8"
                            Padding="12,10"
                            SemanticProperties.Description="{Binding ErrorMessage, StringFormat='Error: {0}'}">
                        <HorizontalStackLayout Spacing="8">
                            <Label Text="✕"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   TextColor="#DC2626"
                                   VerticalOptions="Center"
                                   SemanticProperties.Description="Error icon" />
                            <Label Text="{Binding ErrorMessage}"
                                   TextColor="#DC2626"
                                   FontSize="13"
                                   VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </Border>

                    <!-- Start Button -->
                    <Button Text="{Binding IsCreating, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Starting...|Start Training'}"
                            Command="{Binding StartTrainingCommand}"
                            IsEnabled="{Binding IsCreating, Converter={StaticResource InverseBoolConverter}}"
                            BackgroundColor="{AppThemeBinding Light=#4F46E5, Dark=#6366F1}"
                            TextColor="White"
                            CornerRadius="8"
                            Padding="24,16"
                            FontSize="16"
                            FontAttributes="Bold"
                            HorizontalOptions="Fill"
                            SemanticProperties.Description="Start Training button. Creates and starts the training run with configured settings." />

                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
